\input{relatorio}

\begin{document}

\renewcommand{\titulo}{Projeto 6}
\pagenumbering{arabic}
\makecover
\makelists

Nesta experiência é dada continuidade ao que foi ensinado no semestre
anterior. Seré visto aqui como se extrai o \emph{netlist} para simulação já a
partir do esquemático, permitindo a verificação da sua funcionalidade.
Também será visto como fazer a comparação entre \emph{layout} e esquemático. Por
fim é introduzida a simulação do tipo Monte Carlo que possibilita analisar
o comportamento dos circuitos com as variações dos parâmetros dos
transistores.


\textbf{1.} *Considere a porta lógica \emph{CMOS} estática que implementa a função
   lógica $\overline{(AB+C)}$. Tendo o transistor \emph{NMOS} de menor dimensão um
   $W = 2 \mu m$ e $L = 0,35 \mu m$, determine as dimensões de todos transistores
   de forma que:
\begin{lsienumerate}
    \item (atraso de propagação na descida com ABC = "110") = (atraso de
      propagação na descida com ABC = "001") = (pior atraso de propagação na
      subida);
    \item Todos transistores \emph{PMOS} tenham as mesmas dimensões.
\end{lsienumerate}
(deixe indicado os valores usados)

\begin{figure}[!hb]
    \begin{center}
        \begin{tikzpicture}

            %vcc
            \draw   (-0.3, 3.8) -- (0  , 4.1)
                                -- (0.3, 3.8);
            \draw (0, 4.1) -- (0, 3.4);

            %bloco P
            \draw   (-1.5, 3.4) -- ( 1.5, 3.4)
                                -- ( 1.5, 2.9)
                                -- ( 1.8, 2.9) %M2
                                -- ( 1.8, 2.2)
                                -- ( 1.5, 2.2)
                                -- ( 1.5, 1.7)
                                -- (-1.5, 1.7)
                                -- (-1.5, 2.2)
                                -- (-1.8, 2.2) %M1
                                -- (-1.8, 2.9)
                                -- (-1.5, 2.9)
                                -- (-1.5, 3.4);

            \draw  (0, 1.7) -- (0, 1.2  )
                            -- (0.3, 1.2) %M3
                            -- (0.3, 0.5)
                            -- (0  , 0.5)
                            -- (0  , 0  );

            \draw     (-2 , 2.2 ) -- (-2  , 2.9 ); %M1
            \draw     (-2 , 2.55) -- (-2.5, 2.55) node [anchor=east] {A};
            \draw     (-1.5, 2.55) node [anchor=west] {$M_1$};
            \filldraw (-1.8, 2.9) -- (-1.7, 3   )
                                  -- (-1.7, 2.8 )
                                  -- cycle;
            \draw     ( 2 , 2.2 ) -- ( 2  , 2.9 ); %M2
            \draw     ( 2 , 2.55) -- ( 2.5, 2.55) node [anchor=west] {B};
            \draw     ( 1.5, 2.55) node [anchor=east] {$M_2$};
            \filldraw ( 1.8, 2.9) -- ( 1.7, 3   )
                                  -- ( 1.7, 2.8 )
                                  -- cycle;
            \draw     (0.5, 1.2 ) -- ( 0.5, 0.5 ); %M3
            \draw     (0.5, 0.85) -- ( 1  , 0.85) node [anchor=west] {C};
            \draw     (0.3, 0.85) node [anchor=east] {$M_3$};
            \filldraw (0.3, 1.2 ) -- ( 0.2, 1.3 )
                                  -- ( 0.2, 1.1 )
                                  -- cycle;

            %bloco N
            \draw  (1.5, 0) -- (-1.5,  0   )
                            -- (-1.5, -0.5 )
                            -- (-1.8, -0.5 ) %M4
                            -- (-1.8, -1.2 )
                            -- (-1.5, -1.2 )
                            -- (-1.5, -2.2 )
                            -- (-1.8, -2.2 ) %M5
                            -- (-1.8, -2.9 )
                            -- (-1.5, -2.9 )
                            -- (-1.5, -3.4 )
                            -- ( 1.5, -3.4 )
                            -- ( 1.5, -2.05)
                            -- ( 1.8, -2.05) %M6
                            -- ( 1.8, -1.35)
                            -- ( 1.5, -1.35)
                            -- ( 1.5, 0    );

            \draw     (-2  , -0.5 ) -- (-2  , -1.2 ); %M4
            \draw     (-2  , -0.85) -- (-2.5, -0.85) node [anchor=east] {A};
            \draw     (-1.5, -0.85) node [anchor=west] {$M_4$};
            \filldraw (-1.5, -1.2 ) -- (-1.6, -1.1 )
                                    -- (-1.6, -1.3 )
                                    -- cycle;
            \draw     (-2  , -2.2 ) -- (-2  , -2.9 ); %M5
            \draw     (-2  , -2.55) -- (-2.5, -2.55) node [anchor=east] {B};
            \draw     (-1.5, -2.55) node [anchor=west] {$M_5$};
            \filldraw (-1.5, -2.9 ) -- (-1.6, -3   )
                                    -- (-1.6, -2.8 )
                                    -- cycle;
            \draw     ( 2  , -2.05) -- ( 2  , -1.35); %M6
            \draw     ( 2  , -1.7 ) -- ( 2.5, -1.7 ) node [anchor=west] {C};
            \draw     ( 1.5, -1.7 ) node [anchor=east] {$M_6$};
            \filldraw ( 1.5, -2.05) -- ( 1.6, -2.15)
                                    -- ( 1.6, -1.95)
                                    -- cycle;

            %terra
            \draw ( 0  , -3.4) -- (0  , -3.9);
            \draw (-0.5, -3.9) -- (0.5, -3.9);
            \draw (-0.3, -4.1) -- (0.3, -4.1);
            \draw (-0.1, -4.3) -- (0.1, -4.3);
        \end{tikzpicture}
    \end{center}
    \caption{Porta lógica \emph{CMOS}. Implementa a função $\overline{AB + C}$.}
    \label{figPortaLogicaQ1}
\end{figure}

Seja o tempo de propagação dado pela seguinte relação:
\begin{equation}
    t_p = \frac{1,6 \cdot C_L}{\mu \cdot \left( \frac{W}{L} \right) \cdot C_{ox} \cdot V_{DD}}
\end{equation}

No caso 110, teremos os transistores $M_4$ e $M_5$ abertos, realizando a descida do
sinal. Para o cálculo tempo de propagação na descida, teremos um transistor equivalente
com as seguintes dimensões:
\begin{eqnarray}
    W_{eq} & = & W_{M_4,M_5}\\
    L_{eq} & = & 2 \cdot L
\end{eqnarray}

Por outro lado, no caso 001, somente o transistor $M_6$ abre. Desta forma as dimensões
equivalentes são as mesmas dimensões do transistor $M_6$:
\begin{eqnarray}
    W_{eq} & = & W_{M_6}\\
    L_{eq} & = & L
\end{eqnarray}

Desta forma temos:
\begin{eqnarray}
    t_{pHL(110)} & = & \frac{1,6 \cdot C_L}{\mu_N \cdot \left( \frac{W_{M_4,M_5}}{2 \cdot L}
                                        \right) \cdot C_{ox} \cdot V_{DD}} \label{eqntphl110q1}\\
%
    t_{pHL(001)} & = & \frac{1,6 \cdot C_L}{\mu_N \cdot \left( \frac{W_{M_6}}{L} \right)
                                                \cdot C_{ox} \cdot V_{DD}} \label{eqntphl001q1}
\end{eqnarray}
e, ao igualarmos (\ref{eqntphl110q1}) e (\ref{eqntphl001q1}), eliminaremos todas as variáveis não
abordadas até o momento, obtendo a relação:
\begin{eqnarray}
    \frac{W_{M_4,M_5}}{2 \cdot L} & = & \frac{W_{M_6}}{L}\\
    \Rightarrow W_{M_4,M_5} & = & 2 \cdot W_{M_6}
\end{eqnarray}

Como $W_{M_6} < W_{M_4,M_5} \Rightarrow W_{M_6} = 2 \mu m$. Logo:
\begin{equation}
    W_{M_4,M_5} = 2 \cdot 2 \mu m = 4 \mu m
\end{equation}
\begin{equation}
    \Rightarrow W_{M_4} = W_{M_5} = 4 \mu m
\end{equation}

Para o análise dos transistores \emph{PMOS}, tomamos como os piores casos $ABC = 101$ ou
$ABC = 011$. Os transistores equivalente --- utilizado no cálculo do tempo de propagação ---
de ambos os casos possuem as mesmas dimensões, mostradas a seguir:
\begin{eqnarray}
    W_{eq} & = & W_P\\
    L_{eq} & = & 2 \cdot L
\end{eqnarray}

Desta forma, podemos modelar o pior atraso de propagação na subida como:
\begin{equation}
    t_{pLH(101|011)} = \frac{1,6 \cdot C_L}{\mu_P \cdot \left( \frac{W_P}{2 \cdot L}
                                        \right) \cdot C_{ox} \cdot V_{DD}} \label{eqntplhq1}
\end{equation}

Igualando as equações (\ref{eqntphl001q1}) e (\ref{eqntplhq1}), analogamente ao que foi feito
para os trnasistores \emph{NMOS}, podemos calcular $W_P$:
\begin{eqnarray}
    W_P & = & 2 \cdot \frac{\mu_N}{\mu_P} \cdot W_{M_6}\\
    \Rightarrow W_P & \approx & 12,90 \mu m
\end{eqnarray}
para $\mu_N = 476cm^2/Vs$ e $\mu_P = 148cm^2/Vs$.

\textbf{2.} Faça o circuito esquemático da porta \emph{CMOS} e gere seu símbolo. Faça
   todas as verificações necessárias no esquemático e no símbolo não deixando nenhum
   erro ou \emph{warning}. Não esqueça de ligar o \emph{bulk} dos transistores.

\textbf{3.} Crie para o esquemático um \emph{designview point} para poder gerar
   arquivos para simulação e comparar com \emph{layout}. Para isso execute o comando
   \textbf{ \emph{Hit-Kit Utilites -- Create Viewpoint} } na parte superior da
   janela do \emph{Design Architecture}. No menu que aparece coloque o nome de seu
   arquivo esquemático no \emph{Design Path}. Deixe a opção \emph{device}.

\textbf{4.} Agora gere um arquivo \emph{netlist} para o \emph{ELDO}. Para isso entre
   no \emph{Simulation mode} (coluna esquerda da janela do \emph{Design Architecture}
   , último comando). No menu selecione o \emph{vpt\_c35b4\_device}, que foi gerado
   no item anterior, e dê \emph{OK}.

Obs.: A partir da nova janela podemos retornar à  anterior executando
novamente o último comando da coluna à esquerda.

\textbf{5.} *Gere o \emph{netlist} executando o comando apropriado na coluna à
   esquerda. Com outro comando nessa coluna, o \emph{ASCII Results}, verifique os
   resultados na opção \emph{view netlist}. Acrescente o \emph{netlist} ao relatório.

    O \emph{netlist} gerado automaticamente a partir do \emph{viewpoint} está descrito
    no código fonte \ref{lst_porta_logica_q5}.

   \begin{lstlisting}[caption=\emph{Netlist} gerado a partir do \emph{viewpoint}, label=lst_porta_logica_q5]
*
* .CONNECT statements
*
.CONNECT GROUND 0


* ELDO netlist generated with ICnet by 'cad' on Wed Aug 13 2014 at 16:18:27

*
* Globals.
*
.global VDD VSS

*
* MAIN CELL: Component pathname : $lab6/default.group/logic.views/ex2
*
    M_PMOS_C S C N$209 VDD MODP w=1.290000e-05 l=3.500000e-07 as=1.096500e-11
+  ad=1.096500e-11 ps=1.460000e-05 pd=1.460000e-05 nrs=3.294574e-02 nrd=3.294574e-02
    M_PMOS_B N$209 B VDD VDD MODP w=1.290000e-05 l=3.500000e-07 as=1.096500e-11
+  ad=1.096500e-11 ps=1.460000e-05 pd=1.460000e-05 nrs=3.294574e-02 nrd=3.294574e-02
    M_PMOS_A N$209 A VDD VDD MODP w=1.290000e-05 l=3.500000e-07 as=1.096500e-11
+  ad=1.096500e-11 ps=1.460000e-05 pd=1.460000e-05 nrs=3.294574e-02 nrd=3.294574e-02
    M_NMOS_C S C VSS VSS MODN w=2.000000e-06 l=3.500000e-07 as=1.700000e-12
+  ad=1.700000e-12 ps=3.700000e-06 pd=3.700000e-06 nrs=2.125000e-01 nrd=2.125000e-01
    M_NMOS_B N$207 B VSS VSS MODN w=4.000000e-06 l=3.500000e-07 as=3.400000e-12
+  ad=3.400000e-12 ps=5.700000e-06 pd=5.700000e-06 nrs=1.062500e-01 nrd=1.062500e-01
    M_NMOS_A S A N$207 VSS MODN w=4.000000e-06 l=3.500000e-07 as=3.400000e-12
+  ad=3.400000e-12 ps=5.700000e-06 pd=5.700000e-06 nrs=1.062500e-01 nrd=1.062500e-01
*
.end
   \end{lstlisting}

\textbf{6.} *Como são calculadas as áreas e perímetros de dreno e \emph{source} no
   circuito extraído pelo esquemático (relação usada)?

   Conforme o manual \emph{ELDO equations}, temos que:
   \begin{eqnarray}
        AS & = & W \cdot XA\\
        AD & = & W \cdot XA\\
        PS & = & W + 2 \cdot XA\\
        PD & = & W + 2 \cdot XA,
   \end{eqnarray}
   onde $AS$ é a area de \emph{source}, $AD$ é a área de dreno, $PS$ é o perímetro
   de \emph{source}, $PD$ é o perímetro de dreno e $XA$ é o comprimento da difusão.
   Neste caso o comprimento da difusão é \mbox{$XA=0.85\mu m$}.

\textbf{7.} Observe que no \emph{netlist} não aparecem as capacitâncias parasitas
   que são geradas quando é feita a extração do \emph{layout}. Prepare um arquivo
   para simulação e, com os parâmetros típicos, $V_{DD} = 3V$, determine o atraso de
   propagação na subida \emph{versus} capacitância de carga (entrada com onda
   quadrada com \emph{rise/fall time} pequenos (1\% do período, por exemplo)).
   Escolha os sinais de entrada de forma a obter a pior situação, ao menos cinco
   valores para a capacitância de carga, e escolha o período dos sinais de forma a
   obter resultados corretos. Faça o mesmo para o atraso de propagação na descida
   \emph{versus} capacitância de carga.

\textbf{8.} *Apresente os gráficos da questão anterior e copie os comandos de medida
   e sinais de entrada que usou no \emph{ELDO}.

    Os atrasos medidos na questão anterior podem ser vistos na imagem \ref{imgApcQ8}.
    Os comandos utilizados em suas medidas estão disponíveis no Código Fonte \ref{lstMeasureQ8}.
    As formas de onda dos sinais de entrada $A$, $B$ e $C$ estão na imagem \ref{imgSinEntQ8}.

    \begin{lstlisting}[caption=Comandos utilizados para a medição de atraso de subida e descida por capacitância de carga., label=lstMeasureQ8]
*
* .CONNECT statements
*
.CONNECT GROUND 0

* ELDO netlist generated with ICnet by 'cad' on Wed Aug 13 2014 at 14:50:34

*
* Globals.
*
.global VDD VSS

*
* MAIN CELL: Component pathname : $lab6/default.group/logic.views/ex2
*
    M_PMOS_C S C N$209 VDD MODP w=1.290000e-05 l=3.500000e-07 as=1.096500e-11
+  ad=1.096500e-11 ps=1.460000e-05 pd=1.460000e-05 nrs=3.294574e-02 nrd=3.294574e-02
    M_PMOS_B N$209 B VDD VDD MODP w=1.290000e-05 l=3.500000e-07 as=1.096500e-11
+  ad=1.096500e-11 ps=1.460000e-05 pd=1.460000e-05 nrs=3.294574e-02 nrd=3.294574e-02
    M_PMOS_A N$209 A VDD VDD MODP w=1.290000e-05 l=3.500000e-07 as=1.096500e-11
+  ad=1.096500e-11 ps=1.460000e-05 pd=1.460000e-05 nrs=3.294574e-02 nrd=3.294574e-02
    M_NMOS_C S C VSS VSS MODN w=2.000000e-06 l=3.500000e-07 as=1.700000e-12
+  ad=1.700000e-12 ps=3.700000e-06 pd=3.700000e-06 nrs=2.125000e-01 nrd=2.125000e-01
    M_NMOS_B N$207 B VSS VSS MODN w=4.000000e-06 l=3.500000e-07 as=3.400000e-12
+  ad=3.400000e-12 ps=5.700000e-06 pd=5.700000e-06 nrs=1.062500e-01 nrd=1.062500e-01
    M_NMOS_A S A N$207 VSS MODN w=4.000000e-06 l=3.500000e-07 as=3.400000e-12
+  ad=3.400000e-12 ps=5.700000e-06 pd=5.700000e-06 nrs=1.062500e-01 nrd=1.062500e-01
*
.PARAM cload=100f
Cl S VSS cload

*** pulso ***
.PARAM tvdd=3V
.PARAM frequencia=230MegHz
.PARAM periodo='1/frequencia'
.PARAM delay=0s
.PARAM tSubida='0.01*periodo'
.PARAM tDescida='0.01*periodo'
.PARAM larguraPulso='0.49*periodo'
.PARAM valto='tvdd'
.PARAM vbaixo=0V

*** varredura ***
.PARAM vStep=50f
.PARAM vInit=100f
.PARAM vEnd=300f

Vcc VDD VSS tvdd
Vgnd VSS 0  0

Va A VSS tvdd
Vb B VSS PULSE (vbaixo valto delay tSubida tDescida larguraPulso periodo)
Vc C VSS 0

.TRAN 1ns '20*periodo' '5*periodo' 0.1ns SWEEP cload INCR vStep vInit vEnd
.PROBE TRANS V(A) V(B) V(C) V(S)

*** Delay ***
.MEAS TRAN DEL_H2L TRIG V(B) VAL=1.5V RISE=5 TARG V(S) VAL=1.5 FALL=5
.MEAS TRAN DEL_L2H TRIG V(B) VAL=1.5V FALL=5 TARG V(S) VAL=1.5 RISE=5

.INC '~/para_prova/tipico.mod'

.end

    \end{lstlisting}
    \img{Atraso de subida e descida por capacitância de carga obtido pela simulação do 
        \emph{viewpoint}.}{imgApcQ8}{atraso_por_capacitancia_q8.jpg}
    \img{Sinais de entrada e saída utilizados na simulação do \emph{viewpoint}.}{imgSinEntQ8}{sinais_entrada_saida_q8.jpg}


\textbf{9.} Faça agora o \emph{layout} da porta (utilize o \emph{designview point}
   gerado para geração). No \emph{layout} deve-se tomar cuidado com:
\begin{lsitemize}
    \item área total do circuito;
    \item o uso correto dos metais e poli como camadas de conexão;
    \item a posição dos \emph{ports} de entrada e saída.
\end{lsitemize}
   Faça a verificação com o \emph{DRC (CALIBRE)} e elimine todos os erros.

Obs.: Veja as opções do \textbf{ \emph{Route -- ARoute Commands -- Setup -- Display} }
para melhor fazer o roteamento manual.

\textbf{10.} Utilize o comando \textbf{ \emph{Connectivity -- port -- Add to Port} }
   para ampliar as áreas dos \emph{ports}. Para isso selecione o \emph{shape} que
   deseja acrescentar a um \emph{port} e então execute o comando.

\textbf{11.} *Como se pode acrescentar aos \emph{ports} $V_{DD}$ e $V_{SS}$ as
   regiões de \emph{source} dos transistores sem transformarmos os transistores
   em \emph{flatten}?

   Para adicionar o \emph{source} ao $V_{DD}$ ou ao $V_{SS}$ deve-se adicionar um novo
   \emph{shape} de metal 1, sobre o metal do \emph{source}. Este shape pode ser adicionado
   aos ports $V_{DD}$ ou $V_{SS}$.

\textbf{12.} Uma vez acrescentadas aos \emph{ports} todas as regiões desejadas, faça
   nova verificação com o \emph{DRC}.

\textbf{13.} Vamos agora fazer a última verificação do circuito: comparação entre o
   \emph{layout} e o esquemático que o gerou (\emph{Layout vs. Schematic} ou
   simplesmente \emph{LVS}). Para isso, dentro do \emph{ICStation} feche o circuito
   lógico associado ao \emph{layout} (\textbf{ \emph{File -- Logic -- close} },
   menu superior). Execute então os comandos \emph{IcTrace(M)} e \emph{LVS} (menu à
   direita). No menu que aparece complete o \emph{source name} (nome do
   \emph{netlist} para comparar que esta no
   \verb|... logic.view/name/.../vpt_c35b4_device|) e na opção \emph{Abort on
   Supply Error}, deixe \emph{NO}. Verifique a função das outras opções que estão
   disponíveis.

\textbf{14.} Ao dar o \emph{OK}, é feita a comparação entre os \emph{netlists}
   extraídos do \emph{layout} e do esquemático. Para ver se há ou não erros execute
   o comando \textbf{ \emph{IcTrace(M) -- LVS -- Report -- LVS} }. Verifique também
   as outras opções no menu de \emph{Report}. Caso não houver erros aparecerá a
   \emph{"carinha feliz"} se houver, serão fornecidas informações sobre os erros.

\textbf{15.} Para determinar onde estão os erros pode ser usado o comando
   \textbf{ \emph{IcTrace(M) -- discreps.} } A opção \emph{first} aí mostra o
   primeiro erro; a opção \emph{next}, o próximo. Caso tenha tido algum erro tente
   achá-lo com esses comandos; se não teve erros, modifique o \emph{layout} (apague
   alguma conexão) para poder praticar (caso não pratique na aula poderá ter
   surpresas na prova).

Obs.: o comando \emph{discreps} deixa selecionada uma ou mais regiões do circuito.
Essas regiões selecionadas são deselecionadas apenas pelo comando
\textbf{ \emph{IcTrace(M) -- unshow -- all} }. Algo similar acontece com o \emph{DRC}.
Obs.: O comando \textbf{ \emph{IcTrace(M) -- netlist} } também serve, como o
\emph{PEX (CALIBRE)}, para gerar \emph{netlists} para o \emph{ELDO}.

\textbf{16.} *Uma vez feitas as verificações com \emph{DRC} e \emph{LVS}, caso não
   tenha sido encontrado nenhum erro, o \emph{layout} estará pronto para uso. Agora,
   extraia o circuito de simulação a partir do \emph{layout} (opção C+CC) e repita as
   simulações feitas no item 7. Apresente os gráficos com resultados (gere uma figura
   do \emph{layout} e inclua no trabalho).

   O gráfico com os atrasos de subida e descida estão na figura \ref{imgApcQ16} e os
   sinais de entrada e saída estão na figura \ref{imgSinEntQ16}. O layout pode ser visto
   na figura \ref{imgLayoutQ16}.

   \img{Atraso de subida e descida por capacitância de carga.}{imgApcQ16}{atraso_por_capacitancia_q16.jpg}

   \img{Sinais de entrada e de saída da porta lógica.}{imgSinEntQ16}{sinais_entrada_saida_q16}

   \img[0.35]{\emph{Layout} da porta lógica apresentada na figura \ref{figPortaLogicaQ1}.}{imgLayoutQ16}{layout_q16.png}

\textbf{17.} *Para as curvas atraso de propagação na subida e descida \emph{versus}
   carga, geradas a partir do \emph{layout}, calcule as inclinações e o pontos de
   cruzamento com o eixo Y (eixo de tempo).

    A partir dos dados da figura \ref{imgApcQ16}, obtemos:
    \begin{equation}
        \alpha_D = \frac{\Delta y}{\Delta x} = 1386,8
    \end{equation}
    \begin{equation}
        \alpha_S = \frac{\Delta y}{\Delta x} = 1335,8
    \end{equation}
    onde $\alpha_D$ e $\alpha_S$ são os coeficientes angulares dos atrasos de descida e
    subida, respectivamente.

    Seja a o atraso de descida dado por:
    \begin{equation}
        y_D = 1386,8 \cdot x_D + y_{0D}
    \end{equation}
    Substituindo um ponto na fórmula, podemos obter $y_0$:
    \begin{equation}
        y_{0D} = 497,42\cdot10^{-12} - 1386,8 \cdot 250\cdot10^{-15} = 0.15\cdot10^{-9}
    \end{equation}

    Analogamente, calcula-se o $y_0$ de subida:
    \begin{equation}
        y_{0S} = 438,8\cdot10^{-12} - 1335,8 \cdot 250\cdot10^{-15} = 0.10\cdot10^{-9}
    \end{equation}

    Os resultados destes cálculos estão condensados na tabela \ref{tabCalQ17}.
    \begin{table}[!hb]
            \caption{Coeficientes angular e linear para as curvas de atraso de descida e subida
                por capacitância de carga.}
            \label{tabCalQ17}
            \centering
        \begin{tabular}{|l|r|r|}
            \hline 
                                &   Atraso de Descida   &   Atraso de Subida    \\
            \hline 
            Coeficiente Angular &               1386,8  &               1335,8  \\
            \hline 
            Coeficiente Linear  &   $0,15\cdot10^{-9}$  &   $0,10\cdot10^{-9}$  \\
            \hline
        \end{tabular}
    \end{table}

\textbf{18.} *Comente as diferenças entre os resultados encontrados nas questões 8 e
   16/17? Dê as razões para elas.

\textbf{19.} *Faça um inversor com $W_N = 2 \mu m$ e $L_N = 0,35 \mu m$. Faça o
   esquemático, símbolo e \emph{layout}. Passe as verificações no esquemático e
   símbolo. O \emph{layout} deve ser feito com cuidado para ter área pequena,
   utilização correta de metais/poli e \emph{ports} de tamanho conveniente. Passe o
   \emph{DRC} no \emph{layout} e faça o \emph{LVS} deixando a célula pronta para uso.
   Acrescente ao relatório o \emph{layout} feito.

   O \emph{layout} do inversor está apresentado na imagem \ref{imgLayoutQ19}.

   \img[0.35]{\emph{Layout} do inversor.}{imgLayoutQ19}{layout_q19.png}

\textbf{20.} A partir das duas células desenhadas, monte o esquemático de uma nova
   célula que executa a função lógica $(ab+c)$. Gere o seu símbolo e faça
   todas as verificações necessárias.

Obs.: antes de realizar o item 20, deve-se acrescentar aos símbolos
anteriores a propriedade \emph{phy\_comp} com a posição do \emph{layout} de cada
célula.

\textbf{21.} Gere a partir do esquemático o arquivo para simulação com o \emph{ELDO}
   (acrescente o \emph{netlist} ao relatório). Simule com os parâmetros típicos,
   $V_{DD} = 3V$, e determine o atraso de propagação na subida \emph{versus}
   capacitância de carga (entrada com onda quadrada com \emph{rise/fall time}
   igual a 1\%). Escolha os sinais de entrada de forma a obter a pior
   situação, ao menos cinco valores para a capacitância de carga e escolha
   o período dos sinais de forma a obter resultados corretos. Faça o mesmo
   para o atraso de propagação na descida \emph{versus} capacitância de carga.

\textbf{22.} *Desenhe os gráficos da questão anterior e copie os comandos de medida
   e sinais de entrada que usou no \emph{ELDO}.

    Os atrasos estão descritos na figura \ref{imgApcQ22}. Os sinais de entrada 
    utilizados na simulação e a saída obtida podem ser vistos na figura \ref{imgSinEntQ22}.
    O código utilizado para a simulação está descrito na cófigo fonte \ref{lstPniQ22}

    *** referencia de figuras n aparecem????

    \img{Atraso alto-alto e baixo-baixo por capacitância de carga para a porta lógica 
                                não inversora.}{imgApcQ22}{atraso_por_capacitancia_q22.jpg}

    \img{Sinais de entrada e saída utilizados na simulação da porta lógica não 
                                    inversora.}{imgSinEntQ22}{sinais_entrada_saida_q22.jpg}

    \begin{lstlisting}[caption=Arquivo utilizado para a simulação da porta lógica não
                                                            inversora, label=lstPniQ22]
*
* .CONNECT statements
*
.CONNECT GROUND 0

* ELDO netlist generated with ICnet by 'cad' on Mon Aug 18 2014 at 11:31:24

*
* Globals.
*
.global VDD VSS

*
* Component pathname : $lab_seis/default.group/logic.views/inversor
*
.subckt INVERSOR  OUT IN

    M_2 OUT IN VSS VSS MODN w=2.000000e-06 l=3.500000e-07 as=1.700000e-12
+  ad=1.700000e-12 ps=3.700000e-06 pd=3.700000e-06 nrs=2.125000e-01 nrd=2.125000e-01
    M_1 OUT IN VDD VDD MODP w=6.450000e-06 l=3.500000e-07 as=5.482500e-12
+  ad=5.482500e-12 ps=8.150000e-06 pd=8.150000e-06 nrs=6.589147e-02 nrd=6.589147e-02
.ends INVERSOR

*
* Component pathname : $lab_seis/default.group/logic.views/exdois
*
.subckt EXDOIS  S A B C

    M3 N$209 B VDD VDD MODP w=1.290000e-05 l=3.500000e-07 as=1.096500e-11
+  ad=1.096500e-11 ps=1.460000e-05 pd=1.460000e-05 nrs=3.294574e-02 nrd=3.294574e-02
    M2 N$209 A VDD VDD MODP w=1.290000e-05 l=3.500000e-07 as=1.096500e-11
+  ad=1.096500e-11 ps=1.460000e-05 pd=1.460000e-05 nrs=3.294574e-02 nrd=3.294574e-02
    M_4 S C N$209 VDD MODP w=1.290000e-05 l=3.500000e-07 as=1.096500e-11
+  ad=1.096500e-11 ps=1.460000e-05 pd=1.460000e-05 nrs=3.294574e-02 nrd=3.294574e-02
    M_3 S C VSS VSS MODN w=2.000000e-06 l=3.500000e-07 as=1.700000e-12
+  ad=1.700000e-12 ps=3.700000e-06 pd=3.700000e-06 nrs=2.125000e-01 nrd=2.125000e-01
    M1 N$207 B VSS VSS MODN w=4.000000e-06 l=3.500000e-07 as=3.400000e-12
+  ad=3.400000e-12 ps=5.700000e-06 pd=5.700000e-06 nrs=1.062500e-01 nrd=1.062500e-01
    M_1 S A N$207 VSS MODN w=4.000000e-06 l=3.500000e-07 as=3.400000e-12
+  ad=3.400000e-12 ps=5.700000e-06 pd=5.700000e-06 nrs=1.062500e-01 nrd=1.062500e-01
.ends EXDOIS

*
* MAIN CELL: Component pathname : $lab_seis/default.group/logic.views/exvinte
*

*** varredura ***
.PARAM cload=100f
.PARAM vStep=50f
.PARAM vInit=100f
.PARAM vEnd=300f

    X_INVERSOR2 S N$5 INVERSOR
    X_EXDOIS2 N$5 A B C EXDOIS
    Cl S VSS cload

*** pulso ***
.PARAM tvdd=3V
.PARAM frequencia=230MegHz
.PARAM periodo='1/frequencia'
.PARAM delay=0s
.PARAM tSubida='0.01*periodo'
.PARAM tDescida='0.01*periodo'
.PARAM larguraPulso='0.49*periodo'
.PARAM valto='tvdd'
.PARAM vbaixo=0V

VDD VDD 0 tvdd
VSS VSS 0 0
VIN VIN 0 PULSE (vbaixo valto delay tSubida tDescida larguraPulso periodo)

.CONNECT A VDD
.CONNECT B VIN
.CONNECT C VSS

*** ANALISE TRANSIENTE ***
.PARAM tprint=1ns
.PARAM hmax='0.1*tprint'

.TRAN 1ns '20*periodo' '5*periodo' 0.1ns SWEEP cload INCR vStep vInit vEnd

*** Delay ***
.MEAS TRAN DEL_H2H TRIG V(B) VAL=1.5V RISE=5 TARG V(S) VAL=1.5 RISE=5
.MEAS TRAN DEL_L2L TRIG V(B) VAL=1.5V FALL=5 TARG V(S) VAL=1.5 FALL=5

.PROBE TRANS V(A) V(B) V(C) V(S)
*
.include "~/para_prova/tipico.mod"

.end

    \end{lstlisting}

\textbf{23.} Faça o \emph{layout} final da célula. Utilize nas linhas de metal que
   ligam o $V_{DD}$ e o $V_{SS}$ largura sempre superior ou igual a $1,0 \mu m$. Para
   isso veja e utilize o comando \textbf{ \emph{Route -- ARoutre NEt Classe -- Edit} }
   que permite especificar as características de conexão de qualquer sinal. Utilize
   a opção \emph{New/Edit} para fornecer as características desejadas e a opção
   \emph{Assign} para associá-las a um sinal (e apenas um). Coloque os sinais de
   $V_{DD}$ e o $V_{SS}$ com metais de $1,0 \mu m$.

Obs.: Veja que quando se esta executando o comando \textbf{ \emph{Route -- Iroute Commands -- Run} }, 
a tecla \emph{w} pode ser utilizada para alterar a largura da linha desenhada.

\textbf{24.} *Termine layout da célula, passe o \emph{DRC} e faça o \emph{LVS}. Gere
   uma figura do \emph{layout} mostrando todos os níveis e inclua no trabalho.

    O \emph{layout} da porta lógica não inversora está na figura \ref{imgLayoutQ24}.

    \img{Layout da porta lógica não inversora.}{imgLayoutQ24}{layout_q24.png}

\textbf{25.} *Agora extraia o circuito de simulação a partir do \emph{layout} (opção
   C+CC) e repita as simulações feitas no item 22. Apresente gráficos e tabelas
   com os resultados.

    O gráfico de atraso por capacitância de carga está representado na figura \ref{imgApcQ25}.
    Os sinais de entrada utilizados na simulação e a saída da porta lógica não inversora estão
    na figura \ref{imgSinEntQ25}. Na tabela \ref{tblApcQ25} podemos observar os valores dos 
    atrasos para cada capacitância de carga utilizada na simulação.

    \img{Atraso alto-alto e baixo-baixo para a porta lógica não inversora obtidos através
       de simulação do circuito com capacitâncias parasitas.}{imgApcQ25}{atraso_por_capacitancia_q25.jpg}

    \img{Sinais de entrada utilizados na simulação e saída obtida para a porta lógica
        não inversora}{imgSinEntQ25}{sinais_entrada_saida_q25.jpg}

    \begin{table}[!hb]
        \caption{Atrasos obtidos para diferentes capacitâncias de carga através da simulação
                da porta lógica não inversora.}
        \label{tblApcQ25}
        \centering
        \begin{tabular}{|c|c|c|}
                                                                                                \hline
            Capacitância de Carga (fF)  & Atraso alto-alto (ps) & Atraso baixo-baixo (ps)   \\  \hline
                        100             &       3.7184E-10      &       3.8480E-10          \\  \hline
                        150             &       4.4253E-10      &       4.7144E-10          \\  \hline
                        200             &       5.1329E-10      &       5.5719E-10          \\  \hline
                        250             &       5.8176E-10      &       6.4243E-10          \\  \hline
                        300             &       6.4756E-10      &       7.2473E-10          \\  \hline
        \end{tabular}
    \end{table}

\textbf{26.} *Para as curvas tempo de propagação na subida e descida geradas a
   partir do \emph{layout}, calcule as inclinações e os pontos de cruzamento com o
   eixo Y (eixo de tempo).

   *** Calcular!!!

\textbf{27.} *Gere novamente os tempos de propagação na subida e descida utilizando
   agora os comandos (faça os ajustes necessários para seu circuito)
\begin{lstlisting}
Va  a 0 3V
Vb  b 0 0
Vc  c 0 pulse (0 3 0 1p 1p 2n 4n)
.tran 1n 40n 0n 1p
.meas tran delayF trig v(c) val=1.5  fall=6   targ v(out) val=1.5 fall=6
.meas tran delayR trig v(c) val=1.5  rise=6  targ v(out) val=1.5 rise=6
Cl out 0 30fF
\end{lstlisting}

    *** Esqueci de gerar as imagens...

\textbf{28.} *Vamos realizar agora a \emph{simulação de Monte Carlo}. Nesta simulação
   são realizadas, na verdade, várias simulações com parâmetros diferentes e
   podemos conhecer o comportamento do circuito para diversas condições de
   fabricação. Utiilizando os comandos abaixo realize \emph{Monte Carlo} (faça os
   ajustes necessários para seu circuito, não coloque no arquivo o modelo
   do transistor). Forneça os gráficos da tensão em \emph{c} e na saída (valor
   típico e piores casos) e os gráficos do número de saídas \emph{versus delayF} e
   \emph{delayR}.


\begin{lstlisting}
Va  a 0 3V
Vb  b 0 0
Vc  c 0 pulse (0 3 0 1p 1p 2n 4n)
. tran 1n 30n 0n 10p
.meas tran delayF trig v(c) val=1.5  fall=5   targ v(out) val=1.5 fall=5
.meas tran delayR trig v(c) val=1.5  rise=5  targ v(out) val=1.5 rise=5
Cl out 0 30fF

.option SST_MTHREAD=1
* MONTE CARLO
.MC 100 NBBINS=20
.INCLUDE /local/tools/dkit/ams_3.70_mgc/eldo/c35/profile.opt
.LIB /local/tools/dkit/ams_3.70_mgc/eldo/c35/wc53.lib mc
\end{lstlisting}

    *** Fazer simulação rodar ***

\textbf{29.} *Utilize o comando \textbf{ \emph{Report -- Windows} } do
   \emph{ICStation} para determinar o tamanho da célula (coloque o tamanho de sua
   célula no relatório).

    Conforme o \emph{Windows report} do \emph{mentor}, temos que:\\
    \begin{center}
        \verb!--- Cell Extent:    [[-1.693, 0.969],[20.481,28.600]]!\\
    \end{center}
    logo temos a área $A$ da célula como:
    \begin{eqnarray}
        A & = & \Delta x \cdot \Delta y\\
        A & = & [20.481 \mu m - (-1.693 \mu m)] \cdot (28,600 \mu m - 0.969 \mu m)\\
        \Rightarrow A & = & 612,7 pm^2
    \end{eqnarray}

    Assim a área da célula é de $612,7 pm^2$

\lyxline{}
\begin{verbatim}
manual do Mentor-ELDO: /local/tools/mentor/shared/pdfdocs/eldo_ur.pdf
modelos dos transistores: /local/tools/dkit/ams_3.70_mgc/eldo/c35.
\end{verbatim}

\end{document}
