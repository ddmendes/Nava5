\include{preambulo}


\begin{document} 

\renewcommand{\titulo}{Projeto 9}
\pagenumbering{arabic}
\makecover
\makelists

\section*{Resumo}
    Neste projeto iremos repetir algumas etapas feitas anteriormente e será mostrado como fazer, de forma automática, o \emph{floor planning} e o \emph{placement} das células. Ainda sendo considerados e analisados os valores máximos de frequência de operação.

\section*{Questões}
\textbf{1.}	Considere o circuito da \fref{imgQ01prescaler} (circuito prescaler).

	\img{Prescaler 32/33}{imgQ01prescaler}

    Desenhe o circuito completo do esquemático da \fref{imgQ01prescaler} utilizando as células \verb:DF1:, 
\verb:NAND23:, \verb:NOR23: e \verb:NAND40:. Como sinais de entrada ele deve ter o \emph{clock} e \emph{SM}; como 
sinal de saída, \emph{saida32\_33} (divide o \emph{clock} por 32 ou 33).

	O esquemático do circuito \emph{prescaler} está representado na \fref{imgQ01schematic}.

	\img{Esquemático do circuito \emph{prescaler} 32/33}{imgQ01schematic}
\bigskip

\textbf{2.}	Gere o símbolo para a célula e faça a verificação do esquemático e do símbolo. Certifique-
se de que não haja erros ou mesmo \emph{warnings}.
\bigskip

\textbf{3.}	Gere o \emph{layout} do circuito a partir do \emph{SDL} (utilize o \emph{designviewpoint} e não o \emph{schematic}) 
Para isto:
\begin{enumerate}[label=\alph*.]
	\item Coloque as células no \emph{layout};
	\item Realize o \emph{autofloorplan} (\emph{\textbf{Place \& Route - Autofp}});
	\item Recoloque as células dentro das linhas de \emph{floorplan} (\emph{\textbf{Place \& Route  - AutoPlace - StdCel}});
	\item Apague as linhas que serviriam de guia para os \emph{PADs} (as linhas mais externas);
	\item Selecione todo o esquemático para garantir que todas as ligações no \emph{layout} apareçam. Caso não isto seja feito, no momento do \emph{routing}, várias ligações deixam de ser realizadas;
	\item Para o \emph{rounting}, desabilite a utilização de polisilício (não deixe de fazer isto, pois, caso contrário, o poli será incorretamente usado);
	\item Use o comando \emph{routing}  automático para fazer as ligações. Tome cuidado para que as linhas de \emph{VDD} e \emph{VSS} tenham $1,8 \mu m$ de largura (use a opção \emph{\textbf{Route - ARoutre NEt Classe}});
	\item Para as ligações que não foram feitas, utilize o comando \emph{\textbf{Route - Aroute - Region  - RIP}} (neste caso algumas ligações são desfeitas e nova tentativa é realizada);
	\item Verifique que todas as ligação foram realizadas através do comando \emph{\textbf{Route - Routing 
	Results - SOvrf}}.
\end{enumerate}
\bigskip

\textbf{4.} Verifique se as ligações foram bem feitas (principalmente dos sinais de \emph{VDD} e \emph{VSS}). Refaça 
aquelas que não estiverem boas. Coloque os \emph{ports} no \emph{layout}, conecte-os e coloque os 
\emph{labels}.
\bigskip

\textbf{5.}	Passe o \emph{DRC} no circuito não deixando nenhum erro.
\bigskip

\textbf{6.}	Faça o \emph{LVS} entre o \emph{layout} e o esquemático. Só devem ocorrer \emph{warnings}. Inclua no relatório 
o \emph{layout} feito e corrigido.

    O \emph{layout} do circuito está representado na \fref{imgQ06layout}.

	\img{\emph{Layout} do circuito \emph{prescaler} 32/33}{imgQ06layout}
\bigskip

\textbf{7.}	Considere o circuito da \fref{imgQ07usingPrescaler} (não tem função alguma, servindo apenas para 
ilustração). Desenhe o esquemático desse circuito utilizando a célula \verb:NAND23: e o 
prescaler anterior (faça as devidas checagens).
\img{Circuito utilizando o \emph{prescaler}.}{imgQ07usingPrescaler}
\bigskip

\textbf{8.}	Gere o \emph{layout} a partir do esquemático. Para isto não se esqueça de acrescentar ao 
símbolo do \emph{prescaler} a propriedade \emph{phy\_comp} e como seu valor a localização do \emph{layout}.
\bigskip

\textbf{9.} Termine as conexões, adicione \emph{ports}, faça o \emph{DRC} e o \emph{LVS}. Inclua no relatório o \emph{layout} 
feito.

    O \emph{layout} do circuito está representado na \fref{imgQ09layout}.

    \img{\emph{Layout} do circuito utilizando \emph{prescaler} 32/33}{imgQ09layout}
\bigskip

\textbf{10.} Modifique o circuito adicionando um transistor na saída como indicado na
\fref{imgQ10usingPrescalerAndTransistor}. Novamente gere o \emph{layout}, adicione \emph{ports}, faça o \emph{DRC}
e o \emph{LVS}. Quais são os valores da saída quando o gate do transistor está \emph{"Alto"} e quando está 
\emph{"Baixo"}. Inclua no relatório o \emph{layout} feito.
 
    \img{Circuito utilizando Prescalers e transistor.}{imgQ10usingPrescalerAndTransistor}

    O novo \emph{layout} do circuito está representado na \fref{imgQ10layout}.

	  \img{\emph{Layout} do circuito utilizando \emph{prescaler} 32/33}{imgQ10layout}
\bigskip

\textbf{11.} Voltando ao circuito da \fref{imgQ01prescaler}, extrair a partir do esquemático o \emph{netlist}
e determinar a máxima velocidade para os modelos típico e \emph{worstspeed} (o circuito deve dividir o \emph{clock}
por 32, para SM = "0", ou por 33, para SM = "1"). Use o comando \emph{measure}, compare as freqüências obtidas nos
dois modelos e comente os resultados.

    Analisando os resultados representados na \tref{tblQ15resultados} e nos gráficos em \fref{imgQ11cfreqSMalto}, \fref{imgQ11cfreqSMbaixo}, \fref{imgQ11cfreqSMaltoWS} e \fref{imgQ11cfreqSMbaixoWS}, percebe-se que existe um limiar na frequência onde o circuito passa a se comportar de maneira indesejada. Sem contar que no modelo \emph{worstspeed} o circuito tem uma grande diminuição em sua fequência máxima de operação, como esperado.

	  \img{Relação entre frequência de \emph{clock} e de saída. Típico, SM = "1", esquemático.}{imgQ11cfreqSMalto}
	  \img{Relação entre frequência de \emph{clock} e de saída. Típico, SM = "0", esquemático.}{imgQ11cfreqSMbaixo}
	  \img{Relação entre frequência de \emph{clock} e de saída. \emph{Worstspeed}, SM = "1", esquemático.}{imgQ11cfreqSMaltoWS}
	  \img{Relação entre frequência de \emph{clock} e de saída. \emph{Worstspeed}, SM = "0", esquemático.}{imgQ11cfreqSMbaixoWS}
\bigskip

\textbf{12.} A partir do \emph{layout} do circuito da \fref{imgQ01prescaler}, extrair o circuito para simulação com apenas capacitores. Determinar a máxima velocidade do circuito para o modelo típico e para o modelo \emph{worstspeed}.

    Os resultados estão representados na \tref{tblQ15resultados}, obtidos nos gráficos da \fref{imgQ12cfreqSMalto}, \fref{imgQ12cfreqSMbaixo}, \fref{imgQ12cfreqSMaltoWS} e \fref{imgQ12cfreqSMbaixoWS}.

	  \img{Relação entre frequência de \emph{clock} e de saída. Típico, SM = "1", C + CC.}{imgQ12cfreqSMalto}
	  \img{Relação entre frequência de \emph{clock} e de saída. Típico, SM = "0", C + CC.}{imgQ12cfreqSMbaixo}
	  \img{Relação entre frequência de \emph{clock} e de saída. \emph{Worstspeed}, SM = "1", C + CC.}{imgQ12cfreqSMaltoWS}
	  \img{Relação entre frequência de \emph{clock} e de saída. \emph{Worstspeed}, SM = "0", C + CC.}{imgQ12cfreqSMbaixoWS}
\bigskip

\textbf{13.} Extrair agora o circuito para simulação com capacitores e resistores. Determinar a máxima 
velocidade do circuito para o modelo típico e para o modelo \emph{worstspeed}.

    Os resultados estão representados na \tref{tblQ15resultados}.
\bigskip

\textbf{14.} A partir do \emph{datasheet} dos blocos que compõe o \emph{prescaler} estime o máximo \emph{clock} que o circuito poderia suportar.

    Ao analisar o circuito do \emph{prescaler}, é possível notar que existem dois possíveis caminhos críticos, considerando apenas as partes que dependem do \emph{clock}, que são os representados pelas seguintes equações:
    \begin{eqnarray}
        t_{min_1} & = & t_{set-up} + t_{NAND} + t_{FF} \\
        t_{min_2} & = & t_{set-up} + t_{NOR}  + t_{FF}
    \end{eqnarray}

    Por analisar as configurações dos componentes, sabe-se que a capacitância de carga dos elementos são $C_{NAND} = 20 fF$, $C_{NOR} = 21 fF$ e $C_{FF} = 5 fF$. Utilizando aproximação linear, em conjunção as informações fornecidas pelo documento que contém informações sobre as células, pode-se definir $t_{set-up} = 0 ns$, $t_{FF} = 0,706 ns$, $t_{NOR} = 0,073 ns$ e $t_{NAND} = 0,043 ns$.
    \begin{equation}
        \frac{2,14 - 0,50}{320 - 1} = \frac{t_{FF} - 0,50}{41 - 1}
    \end{equation}
    \begin{equation}
        \frac{1,60 - 0,07}{960 - 3} = \frac{t_{NOR} - 0,07}{5 - 3}
    \end{equation}
    \begin{equation}
        \frac{1,67 - 0,04}{960 - 3} = \frac{t_{NAND} - 0,04}{5 - 3}
    \end{equation}
    \begin{equation}
        t_{min} = max\left(t_{min_1}, t_{min_2}\right)
    \end{equation}
    Assim sendo, $t_{min} = 0,779 ns$ o que implica uma frequência máxima de \emph{clock} de $1,28 GHz$.
\bigskip

\textbf{15.} Monte uma tabela com os resultados obtidos nos exercícios 11, 12, 13 e 14. Compare e comente os resultados. \\

    Os resultados dos exercícios 11, 12, 13 e 14 estão representados na \tref{tblQ15resultados}. \\
    Após uma análise dos dados, percebe-se que há uma grande diferença entre os valores calculados no modelo típico e os calculados no modelo \emph{worstspeed}, o que é bastante esperado. Nos modelos mais complexos a frequência de operação diminui. Isto ocorre devido a serem consideredas as cargas parasitas do circuito (C+CC e R+C+CC). \\
    \begin{table}[!h]
        \caption{Máximas frequência de operação. \label{tblQ15resultados}}
        \centering
        \begin{tabular}{|l|c|c|}
                                                                                                                            \hline
            \textbf{Modelo}         & \textbf{Frequência (MHz) - Típico}& \textbf{Frequência (MHz) - \emph{worstspeed}} \\  \hline
            \emph{datasheet}        &       1.280                       &       1.280                                   \\  \hline
            Esquemático (SM = "1")  &       1.100                       &       740                                     \\  \hline
            Esquemático (SM = "0")  &       1.200                       &       790                                     \\  \hline
            C + CC (SM = "1")       &       840                         &       570                                     \\  \hline
            C + CC (SM = "0")       &       890                         &       600                                     \\  \hline
            R + C + CC (SM = "1")   &       810                         &       XXX                                     \\  \hline % XXX preencher
            R + C + CC (SM = "0")   &       855                         &       XXX                                     \\  \hline % XXX preencher

        \end{tabular}
    \end{table}
\bigskip

\begin{verbatim}
Obs. Endereço com informações sobre células
/local/tools/dkit/ams_3.70_mgc/www/index.html
(Standar Cell DataSheet - C35 - Core Cells).
\end{verbatim}

\end{document}

