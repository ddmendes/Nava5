\include{preambulo}


\begin{document} 

\renewcommand{\titulo}{Projeto 10}
\pagenumbering{arabic}
\makecover
\makelists

\section*{Resumo}
   O objetivo deste projeto é gerar a partir de uma descrição de alto nível
o layout de um circuito.

\section*{Questões}
\textbf{1.} Vamos utilizar agora o programa \emph{LeonardoSpectrum (Windows)}. Para poder
   empregar as bibliotecas da $AMS_0.35 \mu m$ devemos ter alguns arquivos
   (\verb:c35_CORELIB.syn:; \verb:c35_CORELIB_3B.syn:; etc.) no diretório
   \verb!C:\MGC\LeoSpec\LS2005a_82\lib!. Verifique se eles já estão lá; caso não
   estejam, copie os arquivos do diretório \verb:Mentor/Lib: (pen drive) para
   aquele diretório. Ao abrir o Leonardo configure o \emph{working diretory} para
   sua área de trabalho. Neste diretório serão colocados os resultados do
   que fizer.

\textbf{2.} Vamos sintetizar inicialmente o circuito descrito no arquivo uart.vhd do
   diretório Demo (\verb!C:\MGC\LeoSpec\LS2005a_82\Demo!) que descreve um
   universal asynchronous receiver/transmitter. Abra este arquivo no
   Leonardo (\verb:INPUT - Open files:) e então execute o comando \verb:INPUT - Read:.
   Observe que ao ser feita a leitura já é realizada uma primeira síntese.

\textbf{3.} Abra o arquivo texto dentro do \emph{Leonardo} e dê uma olhada no conteúdo do
   \verb:uart.vhd: (click duas vezes em cima do nome do arquivo). Faça alguma
   modificação no arquivo de forma a causar erro (por exemplo, troque
   \verb:"ENTITY uart IS": por \verb:"ENTITY art IS":). Salve, feche o texto e execute
   novamente o \verb:INPUT - Read:. Veja as mensagens de erro. Caso abra novamente
   o arquivo texto aparecerão indicações dos erro.

\textbf{4.} Selecione a tecnologia para \verb:AMS-C35_CORELIB: (\emph{Technology}) e otimize o
   circuito (\verb:Optimize-Optimize:).

\textbf{5.} Veja os esquemáticos que foram gerados (observe o esquemático com a
   opção \emph{multipages} ou não). Qual é a diferença entre o esquemático
   associado a \verb:EXEMPLAR_XTR: e o esquemático associado a \verb:EXEMPLAR:.

   O esquemático \verb:EXEMPLAR: é o esquemático otimizado utilizando apenas
componentes da tecnologia especificada, enquanto o esquemático \verb:EXEMPLAR_XTR:
é o esquemático originalmente gerado pelo programa, sem, necessariamente utilizar
os componentes escolhidos.
\bigskip

\textbf{6.} Verifique o \emph{Critical Path} do esquemático sintetizado e mapeado na
   tecnologia da AMS. O que significa este \emph{critical path} e como é
   calculado?

   O \emph{Critical Path} mostra o caminho do crítico do circuito, isto é, o caminho
que utiliza o maior tempo total de propagação, o tempo que limitará a freqüência de
operação do circuito. \\
   O caminha crítico, \emph{Critical Path}, é calculado somando os atrasos de
propagação gerados por cada componente em um caminho entre dois \emph{Flip-Flops}.
\bigskip

\textbf{7.} Refaça a otimização alterando as opções de objetivo, área, velocidade,
   etc. e verifique os resultados. Variando as opções, minimize o \emph{Critical
   Path}. Qual o valor final obtido e qual a freqüência máxima de operação
   que o circuito sintetizado pode atingir? Apresente no relatório a figura
   do caminho crítico encontrado.

   Após algumas otimizações, foi encontrado um caminho crítico, como mostra a
\fref{imgQ07criticalPath} com tempo de atraso de propagação de $2,48 ns$, o que
implica uma freqüência máxima de operação de $403,2 MHz$.

   \img{Caminho crítico, \emph{Critical Path}, do sistema de acordo com o \emph{LeonardoSpectrum}}{imgQ07criticalPath}
\bigskip

\textbf{8.} Vamos gerar agora um arquivo de saída no formato \emph{Verilog}. O \emph{Verilog} é
   uma linguagem de descrição de hardware usada com C.I.s (mais usada que o
   VHDL na indústria). Este formato servirá de interface para passarmos os
   resultados para o \emph{Design Architecture}. No \emph{Leonardo}, depois de fazer a
   síntese, vá ao menu \emph{Output}, e configure para gerar \emph{Verilog}. De o nome
   que deseja e lembre-se que o resultado será colocado no diretório de
   trabalho que escolheu.

\textbf{9.} Verifique o arquivo de saída com um editor de texto e tente compreender
   a descrição que está feita (ao menos ter uma idéia).

\textbf{10.} Gere arquivos \emph{Verilog} para os circuitos \verb:uart.vhd: e
   \verb:priority_encoder.vhd:. Transfira os arquivos \emph{Verilog} para o Linux (no
   sistema Linux, os arquivos do Windows podem ser vistos no diretório
   /windows). Agora devemos convertê-los para gerar um \emph{layout}. Abra o
   \emph{IcStudio} (em algum projeto que já usou ou em um novo). Nele dê o comando
   \verb:import verilog:. Configure:

   \begin{lstlisting}[numbers=none]
   Output library: onde quer colocar
   Verilog netlist: o arquivo gerado
   Name map file: local/tools/dkit/ams_3.70_mgc/mentor/c35/verilogin_cellmapfiles/c35b4_digital.cellmap
   \end{lstlisting}

   Execute. Deve ser criado tanto o esquemático como o símbolo do circuito
   \verb:uart: e do circuito \verb:priority.encoder:. Verifique ambos. No esquemático da
   \verb:uart: há mais de uma página e para o \emph{Check Schematic} passar corretamente
   as duas páginas do esquemático devem estar abertas.

\textbf{11.} A partir do esquemático (utilize o \emph{viewpoint}) faça a geração do
   \emph{layout} da \verb:uart:. No roteamento utilize para \emph{VDD} e \emph{VSS} apenas linhas mais
   largas do que $1,8 \mu m$. Para conseguir isso utilize, dentro do menu
   \verb:ARoute:, a edição dos \verb:net Classes:.

   Procure nesse circuito fazer o roteamento mas observe que devido ao
   tamanho, completa-lo é bastante trabalhoso. Após o roteamento passe o
   \emph{LVS} e o \emph{DRC}.

Obs.1: Para se posicionar todas as células da \verb:uart: é necessário se ter as
duas páginas do esquemático abertas no ICStation. Para isso utilize o
comando \verb:$open_sheet():. Posteriormente selecione todas as células de cada
esquemático e faça o seu \emph{placement}.

Obs.2: Para terminar \emph{layout} a sugestão é seguir os passos:

  \begin{itemize}
    \item Faça inicialmente o roteamento das linhas de alimentação (\emph{VDD} e \emph{VSS});
    \item Execute, sem colocar os ports, o roteamento automático do restante dos sinais. Deixe os metais configurados para serem utilizados em apenas uma direção;
    \item Quando o número de ligações não feitas estiver em torno de 30, altere a configuração para permitir que os metais sejam utilizados nas duas direções;
    \item Agora selecione uma linha de cada vez e mande executar o roteamento automático. Caso a ferramenta não consiga executar um roteamento, apague as ligações que estão atrapalhando, sempre há, ou tente o RIP. Não use indiscriminadamente o comando RIP, pois algumas vezes ele piora o roteamento;
    \item Quando conseguiu realizar todas as ligações execute o \emph{LVS} (coloque nele a opção "ignorar os ports");
    \item Após o \emph{LVS} dar resultado correto acrescente os \emph{ports} e termine o roteamento;
    \item Passe o \emph{DRC} e corrija os erros (muitos);
    \item Termine o \emph{layout} passando o \emph{LVS} (agora considerando os \emph{ports}).
  \end{itemize}

Obs.3: o item acima é bastante trabalhoso, mas será um excelente treino
para roteamento e \emph{DRC}.

    O \emph{layout} final está representada na \fref{imgQ11layout}.

    \img{\emph{Layout} do circuito \emph{uart}}{imgQ11layout}
\bigskip

\textbf{12.} Considere o circuito da \fref{imgQ12prescaler} (circuito prescaler). \\
  O circuito composto pelos blocos hachurados (três D-\emph{flip-flops} e duas portas lógicas)
  compões uma máquina de estados. Considere que:
  \begin{itemize}
    \item os sinais A, B e C definem o estado da máquina (ex.: o estado 000 é quando A="0",
B="0" e C="0");
    \item esta máquina tem como entrada o sinal MC que define se o circuito divide o \emph{clock}
por 4, MC = "1", ou por 5, MC = "0";
    \item a saída é o sinal A.
  \end{itemize}

  \img{\emph{Prescaler} 32/33}{imgQ12prescaler}

    A máquina de estados implementada está representada na \fref{imgQ12maqEstados}.

  \img{Máquina de estados de um contador 4/5}{imgQ12maqEstados}
\bigskip

\textbf{13.} Verifique que a máquina de estados representada pelo diagrama que
   traçou funciona dividindo o sinal de \emph{clock}  por 4 ou 5, de acordo com o
   valor de \emph{MC}.

\textbf{14.} Descreva a máquina de estados em \emph{VHDL}. Utilize o manual de \emph{VHDL} do
   software Leonardo (\emph{LeonardoSpectrum HDL Synthesis Manual:}
   \verb!D:\MGC\LeoSpec\LS2005a_82\doc\leospec_hdl.pdf!) para ver modelos de
   descrição para máquinas de estado. Apresente o \emph{VHDL} no relatório.

  % TODO
\bigskip

\textbf{15.} Abra e leia o circuito \emph{VHDL}, corrija os possíveis erros e otimize.
   Verifique o circuito gerado e compare com o esquemático da Figura 1.

\textbf{16.} Feche o Leonardo e abra novamente. Leia o \emph{VHDL}, mas tome cuidado para
   utilizar como \verb:Encoding Style: a opção \verb:Binary:. Otimize e veja se o
   resultado melhorou. Otimize o circuito para obter o menor \emph{Critical Path}. \\
   Qual é o valor encontrado? Apresente o esquemático obtido.

  % TODO
\bigskip

\textbf{17.} Sintetize o circuito utilizando a biblioteca da \emph{AMS}.

\textbf{18.} Faça as verificações com \emph{DRC} e \emph{LVS} e apresente o \emph{layout} final.

  % TODO
\bigskip

\textbf{19.} Faça a extração do circuito com \verb:R+C+CC: e determine a máxima velocidade
   que o circuito atinge (teste para \verb:MC = "1": e para \verb:MC= "0":). Compare o
   resultado com o encontrado no item 17.
  % TODO
\bigskip

\end{document}
