\include{preambulo}

\begin{document}

\renewcommand{\titulo}{Projeto 13}
\pagenumbering{arabic}
\makecover
\makelists

\section*{Resumo}

\section*{Introdução}

   Neste trabalho será projetado um relógio especificado. No projeto serão aplicados os recursos aprendidos ao longo do ano, entre estes o uso de VHDL, simulação lógica com MODELSIM, síntese, geração automática de \emph{layout}, verificações com DRC e LVS, extração, simulação com ELDO e avaliação de consumo. Por fim, será analisado tempo de vida de uma bateria alimentando o circuito implementado.

\textbf{1.} Considere que é fornecido um sinal de \emph{clock} na freqüência de $32,768 kHz$ (onda quadrada). Com este sinal projete um circuito que tenha as seguintes características: \\
  sinais de entrada: \textbf{\emph{clk}, modo, ajuste}; \\
  sinais de saída: \textbf{$m_0 \cdots m_5$, $H_0 \cdots H_3$}; \\
  O circuito funciona como um relógio onde os minutos são codificados, binariamente, em $m_0 \cdots m_5$ e as horas, codificadas, binariamente, em $H_0 \cdots H_3$ (horas vai de 0 até 11). Os sinais ajuste e modo servem para indicar a operação do relógio conforme descrito abaixo; \\
  \begin{itemize}
    \item quando ajuste = "1" e modo = "0", os minutos são incrementados a cada $0,5$ segundo;
    \item quando ajuste = "1" e modo = "1", as horas são incrementadas a cada 1 segundo;
    \item quando ajuste = "0", o circuito opera como relógio.
  \end{itemize}
  O projeto envolve
  \begin{itemize}
    \item fazer o esquemático: o esquemático deve ser gerado da forma que achar mais conveniente;
    \item fazer o símbolo com indicação de onde esta o \emph{layout};
    \item fazer simulações: as simulações devem verificar se as operações de relógio e de ajuste estão corretas. Deve ser tomado cuidado com o procedimento de testes pois, dado o tamanho do circuito, ele pode demorar muito. Assim, testes de blocos separados serão necessários;
    \item fazer o \emph{layout} com verificações de DRC e LVS.
  \end{itemize}
  Como características gerais, espera-se que:
  \begin{itemize}
    \item seja um circuito pequeno;
    \item tenha consumo reduzido;
    \item os \emph{ports} de entrada e saída estejam convenientemente colocados.
  \end{itemize}
\bigskip

\textbf{2.} Apresente os esquemáticos do relógio completo e de seus blocos. Descreva sucintamente a função de cada bloco.

  O esquemático do relógio completo está representado na \fref{imgQ02relogioCompleto}. O relógio é composto de 3 blocos principais, divisor $32.768$, divisor 60 e divisor 12. Além destes blocos principais existem também alguns componentes lógicos simples, inseridos no circuito para realizar a seleção de modo de operação e também para solucionar problemas de pulsos extras de \emph{clock}. \\
  Logo na entrada o \emph{clock} de $32.768 Hz$ é dividido pelo bloco referenciado na \fref{imgQ02contador32768}. A saída deste bloco é um sinal de $1 Hz$, $2 Hz$, $4 Hz$ e $8 Hz$. A saída de $1 Hz$ é usada para contar os segundos normalmente. A saída de $2 Hz$ é usada em um dos modos de ajuste. As outras duas saídas, $4 Hz$ e $8 Hz$, são usadas em sincronia com as outras apenas para solucionar o problema gerar um pulso extra na transição entre modo de operação normal e de ajuste. \\
  O bloco divisor de 32.768 concentra, em seus primeiros \emph{flip-flops}, a maior parte da potência dissipada pelo circuito, pois eles operam em uma faixa de frequência conideravelmente superior à dos outros blocos. \\
  Os blocos divisor de 60 e divisor de 12, representados nas \fref{imgQ02contador60} e \fref{imgQ02contador12}, respectivamente, foram feitos em \verb:VHDL: e sintetizados no \emph{Leonardo Spectrum}. Como a frequência de operação destes blocos é baixa, seu consumo de potência é bastante baixo comparado ao resto do circuito. \\
  A lógica de seleção de modo é bastante simples, apenas composta de portas lógicas NAND que controlam os \emph{multplex}s. Para evitar o pulso extra na mudança de modos, o que foi feito é um circuito lógico para que a tensão lógica baixa ocorra apenas em uma pequena parcela de tempo.

  \img{Esqumático do relógio completo}{imgQ02relogioCompleto}
  \img{Esqumático do divisor de 32.768}{imgQ02contador32768}
  \img{Esqumático do divisor de 60}{imgQ02contador60}
  \img{Esqumático do divisor de 12}{imgQ02contador12}

\bigskip

\textbf{3.} Quando uma célula de biblioteca tem mais de uma versão, por exemplo DF1 e DF3, escolha a versão mais apropriada para a aplicação. Justifique o critério aplicado na escolha.

  O critério para escolha das células, para quando existe mais de uma versão para a mesma, é o valor de potência consumida pela célula. \\
  Das células com mais de uma opção, foram escolhidas as células \verb:DF1:, \verb:NAND20:, \verb:NAND30:, \verb:NAND40:, \verb:MUX21: e \verb:CLKINV0:. No caso do inversor, foi escolhido o de menor potência dentro dos inversores simétricos, pois os inversores simétricos possuem um sinal com melhor qualidade.

\bigskip

\textbf{4.} Apresente os \emph{layouts} dos blocos e do circuito final.

  O \emph{layout} do divisor 32.768 está representado na \fref{imgQ04contador32768}. \\
  O \emph{layout} do divisor 60 está representado na \fref{imgQ04contador60}. \\
  O \emph{layout} do divisor 12 está representado na \fref{imgQ04contador12}. \\
  O \emph{layout} do relógio completo está representado na \fref{imgQ04relogioCompleto}. \\

  \img{\emph{Layout} do divisor de 32.768}{imgQ04contador32768}
  \img{\emph{Layout} do divisor de 60}{imgQ04contador60}
  \img{\emph{Layout} do divisor de 12}{imgQ04contador12}
  \img{\emph{Layout} do relógio completo}{imgQ04relogioCompleto}

\bigskip

\textbf{5.} Descreva as simulações realizadas dizendo a função (serve para verificar o quê?), quais são os sinais de comando e de entrada, tempo total que levou a simulação (tempo real) e o que foi observado como resultado (se for gráfico, acrescente o gráfico ao relatório).

  Resultados da simulação do divisor de 12 para verificar a frequência de operação estão representados na \fref{imgQ05cont12}. Como pode-se notar, a divisão ocorre da maneira esperada. O tempo de simulação para esse teste foi de aproximadamente $5,5$ segundos.
  Resultados da simulação do divisor de 60 para verificar a frequência de operação estão representados na \fref{imgQ05cont60}. Como pode-se notar, a divisão ocorre da maneira esperada. O tempo de simulação para esse teste foi de aproximadamente $10$ segundos.
  Resultados da simulação do divisor de 32.768 para verificar a frequência de operação estão representados na \fref{imgQ05cont32768}. Como pode-se notar, a divisão ocorre da maneira esperada. O tempo de simulação para esse teste foi de aproximadamente 1 hora e 25 minutos.

  \img{Resultados do divisor de 12}{imgQ05cont12}
  \img{Resultados do divisor de 60}{imgQ05cont60}
  \img{Resultados do divisor de 32.768}{imgQ05cont32768}

\bigskip

\textbf{6.} Determine a área e estime a potência consumida pelo circuito completo.

  As dimensões do circuito são $258,69 \mu m$ e $112,39 \mu m$, % (84,1 ; 134,407) (342,793 ; 246,8)
logo a área total do circuito é de $29.075 \mu m^{2}$ . \\
  A potência estimada do circuito está, basicamente, toda contida na primeira parte do circuito, que possui 15 \emph{Flip-flops}. Os \emph{Flip-flops} iniciais terão uma frequência de operção alta, logo eles concentrarão o consumo do circuito. \\
  Foi constatado, através de algumas simulações que a potência média do circuito é de $61,0 nW$.

\bigskip

\textbf{7.} Considere que o oscilador que gera o sinal de clock de $32,768 kHz$ consome uma corrente média de $10 \mu A$. Para uma bateria de $1,0 Ah$, por quanto tempo o relógio, circuito projetado mais oscilador, deverá operar (coloque em anos e dias, por exemplo, 4 anos e 36 dias)?

  Sabendo que a potência média consumida pelo relógio é de $61,0 nW$ e sua alimentação de $3,0 V$, tem-se uma corrente total de $10 \mu + \frac{61,0}{3,0} = 10,02 \mu A$, com uma bateria de $1,0 Ah$, esperá-se que o relógio opere por 11 anos e 143 dias. \\
  Valores calculados segundo a equação simples
  \begin{equation}
    tempo = \frac{bateria}{corrente}
  \end{equation}

\bigskip

\textbf{8.} Considere que o sinal de \emph{clock} da entrada apresente tempos de subida/descida de cerca de 30\% do seu período. Nessa situação o circuito continua funcionando? Caso não, qual é a razão?

  Utilizando a configuração com tempos de subida e descida de 30\% do período do \emph{clock}, o circuito para de funcionar corretamente. O primeiro \emph{flip-flop} não funciona corretamente, logo a saída do primeiro componente (divisor 32.768) já não é a esperada. A razão disto é que os transistores N e P das chaves acabam conduzindo ao mesmo tempo, o que faz com que o \emph{flip-flop} não funcione direito. \\
  A \fref{imgQ08waveforms} mostra a resposta do primeiro \emph{flip-flop} com um \emph{clock} com essas configurações.

  \img{Saída dos \emph{flip-flops} com tempo de subida e descida de 30\%}{imgQ08waveforms}

\bigskip

\textbf{9.} Se necessário arrume o problema encontrado no \textbf{item 8}. Com o sinal de relógio como acima, tempos de subida/descida de cerca de 30\% do período, determine a nova potência consumida.

  Uma solução possível para o problema é colocar um inversor na entrada do circuito, pois ele diminuem os tempo de subida e descida relativos ao período. Esse resultado pode ser observado na \fref{imgQ09waveforms}.

  \img{Influencia do inversor nos tempos de subida e descida}{imgQ09waveforms}

\bigskip

\end{document}
